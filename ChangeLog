2019-03-11  Philippe Troin  <phil@fifi.org>
	* tdiff.c (get_numeric_arg): Renamed to get_octal_arg. Defaulted
	to parsing numbers as octal.

	* tdiff.c (struct option_s, printopts, main): Remove hardlinks.
	(show_help, main): Remove -e, --hardlinks, -E, --no-hardlinks
	options.

	* tdiff.zsh (_tdiff): Remove -e, --hardlinks, -E, --no-hardlinks
	options.

	* tdiff.bash (_tdiff): Remove --hardlinks, --no-hardlinks options.

	* configure.ac (--with-bash-functions-dir): Add new --with option.

	* Makefile.am (BASH_FUNCTIONS_DIR): Define substituted variable.
	(install-data-local, uninstall-local): (Un)Install bash completion
	if requested.
	(EXTRA_DIST): Add tdiff.bash.

	* tdiff.bash : Created.

	* configure.ac : Use FI_CHECK_SHELL_FUNCTIONS_DIR([zsh]).

	* m4/fi_check_shell_functions_dir.m4
	(FI_CHECK_SHELL_FUNCTIONS_DIR): Created new macro after
	factorizing the zsh shell function code in configure.ac.

	* Makefile.am (ZSH_FUNCTIONS_DIR): Define substituted variable.
	(install-data-local, uninstall-local): (Un)Install zsh completion
	function if requested.
	(EXTRA_DIST): Define it to tdiff.zsh.

	* configure.ac (--with-zsh-functions-dir): Added new --with
	option.
	(have_zsh): Test for zsh existence for determining default for
	--with-zsh-functions-dir option.
	(ZSH_FUNCTIONS_DIR): AC_SUBST when --with-zsh-functions-dir is
	active.
	(INSTALL_ZSH_FUNCTIONS): New conditional to install zsh functions.

	* tdiff.zsh: Created.

2019-03-10  Philippe Troin  <phil@fifi.org>

	* Makefile.am (distclean-local): Remove autom4te.cache on
	distclean.

	* configure.ac, tdiff.c : If a libc getdents is found, prefer it
	over the syscall versions.

	* configure.ac (HAVE_GETDENTS64_SYSCALL_H): Added feature test.
	Always check libc getdents.

	* tdiff.c : Support getdents64.

	* configure.ac (HAVE_GETDENTS): Use FI_CHECK_EGREP whenever
	possible.  Use cache and include linux_getdents.c to check working
	getdents.

	* linux_getdents.c (getdents): Created from snippet in tdiff.c.
	(struct dent): Renamed to linux_dent.

	* tdiff.c (getdents): Move getdents code to linux_getdents.c.

	* tdiff.c (show_version): Print a feature line (acl, flags,
	readdir & xattr built-in features) on --version.

	* configure.ac (HAVE_MMAP, HAVE_MADVISE): Removed feature tests.

	* tdiff.c (cmpFiles, dodiff): Pass the struct stat of both files
	to avoid extra seeks.
	(cmpFiles): Remove mmap()-base compare algorithm.
	(struct option_s, show_help, printopts, main): Remove nommap.

2019-03-09  Philippe Troin  <phil@fifi.org>

	* tdiff.c (getDirList): Have the opendir() implementation use open with
	O_NOATIME followed by fdopendir if fdopendir is available instead
	of calling opendir (which does not set O_NOATIME).

	* configure.ac (HAVE_O_DIRECTORY, HAVE_FDOPENDIR): New feature
	checks.

	* tdiff.c (printopts): Dump verbosityLevel and nommap.
	(VERB_MEM_STATS): Defined.
	(main): Show memory stats on verbose lovel VERB_MEM_STATS.
	(main): Use line buffering for stdout and stderr to avoid
	intermingling their outputs.

	* utils.c (pmem): Coerce all numbers to long for portability.

	* utils.c, utils.h (pmem): Always define, remove #ifdef DEBUG.

2019-03-08  Philippe Troin  <phil@fifi.org>

	* tdiff.c : Rename opt to opts everywhere for consistency.
	(VERB_STATS): Defined.
	(struct option_s): Added stats member.
	(reportMissingFile): Count single files.
	(reportMissingFile, compareFileEntries): Count excluded files.
	(show_help): Added -vvv option.
	(dodiff): Count compared, contents-compared and two kinds of
	skipped files.
	(main): Initialize options with memset + assignments instead of
	initializer.
	(main): Prints stats on -v.
	(dodiff): Print skip messages on stderr.

	* tdiff.c (VERB_SKIPS, VERB_HASH_STATS): Defined.
	(struct option_s): Rename verbose to verbosityLevel.
	(show_help): Add doc on multiple verbosity levels.
	(dodiff, main): Use verbosityLevel instead of verbose.
	(main): Show inode cache stats if verbosity level is
	VERB_HASH_STATS or more.

	* tdiff.c (dodiff): Since DJB2 hash will go through all bytes in
	the structure including gaps, memset it.

	* inocache.c (ic_hash): Use DJB2 hash algorithm.

	* genhash.c (gh_string_hash): Rename to gh_string_hash_old.
	(gh_string_hash): Use DJB2 hash algorithm.

	* tdiff.c (getAclList): acl_get_file() can return EINVAL on
	MacOSX.

	* tdiff.c (xperror): Created.
	(getXattrList, compareXattrs, getAclList, getDirList, cmpFiles)
	(xreadlink, dodiff): Use xperror.

	* configure.ac (HAVE_GETOPT_LONG, HAVE_MALLINFO, madvise-check)
	(HAVE_LSTAT): Use FI_LINK_IFELSE.

	* m4/fi_link_ifelse.m4 (FI_LINK_IFELSE):  Created.

	* tdiff.c (show_help, main): Add -W option as a shortcut to -w
	diff %1 %2 \;.
	Allow -w/-W/-x options to be specified more than once (and warn
	about it).

	* configure.ac (HAVE_MADVISE): Don't assume that madvise() is
	broken when cross-compiling, but warn about the assumption.

	* tdiff.c (getDirList): Remove superflous test in readdir()
	version. (FreeBSD 12).
	(dodiff): Spell-out flag differences by name instead of just
	giving the hex flags.

	* configure.ac (HAVE_MAJOR_MINOR_FUNCTIONS): Also check if
	major() and minor() are functions (FreeBSD 12).
	(HAVE_UF_*): Update with new flags.

2019-03-07  Philippe Troin  <phil@fifi.org>

	* m4/fi_check_identifiers.m4 (FI_CHECK_IDENTIFIERS): Created.

	* m4/fi_check_identifier.m4 (FI_CHECK_IDENTIFIER): Created.

	* m4/fi_check_egrep.m4 (FI_CHECK_EGREP): Created.

	* configure.ac : Factorize initialization code to FI_PROJECT().

	* m4/fi_project.m4 (FI_PROJECT): Created.

	* configure.ac (AM_MAINTAINER_MODE): Added.
	(AM_PROG_AR): Added, caught by -Wall.
	(getdents, random, najor & minor, st_timensec): Implement caching.
	(GIT_REVISION) Factorized to m4/fi_get_revision.m4.
	(O_NOATIME, S_XXX, UF_XXX, SF_XXX): Use factorized
	m4/fi_get_defines.
	(st_atimespec, st_flags, getxattr): Use factorized
	FI_CHECK_IDENTIFIER.

	* NEWS: Added 0.2.99.WIP release for distcheck.

	* configure.ac (AM_INIT_AUTOMAKE): Add -Wall, check-news.

	* Makefile.am (ACLOCAL_AMFLAGS): Set m4 include path.

	* m4/fi_git_revision.m4 (FI_GIT_REVISION): Created.

	* m4/fi_check_defines.m4 (FI_CHECK_DEFINES): Created.

	* m4/fi_check_define.m4 (FI_CHECK_DEFINE): Created.

	* tdiff.c (getDirList, cmpFiles): Open files with O_NOATIME if
	available.

	* configure.ac (O_NOATIME): Add a check for O_NOATIME.

	* Makefile.am (clean-local): Remove backup files.

	* tdiff.c (show_version): Show git revision in --version.

	* configure.ac: AC_DEFINE the git revision.

	* Makefile.am (maintainer-clean-local): Clean config.aux.

	* configure.ac: Add AC_CONFIG_AUX_DIR(config.aux)

	* tdiff.c (reportMissingFile): Fix bug where tdiff / otherdir
	would report missing files in / with the missing last character.

2014-01-31  Philippe Troin  <phil+github-commits@fifi.org>

	* tdiff.c (dodiff): Do block and size diffs for all types of files
	EXCEPT directories.

2014-01-30  Philippe Troin  <phil+github-commits@fifi.org>

	* tdiff.c (main): Move -n/N option (minor) to -k/K.
	(main): Create --nlinks/-n --hardlinks/-e options.
	(dodiff): Don't do type-specific checks unless both objects are
	the same type.
	(dodiff): Do block and size diffs for all types of files.
	(dodiff): Check nlinks.

2014-01-29  Philippe Troin  <phil+github-commits@fifi.org>

	* configure.ac, Makefile.am, tdiff.c: Add support for nanosecond
	timestamps on Linux.  Fix CFLAGS mess.  Fix reporting data
	corruption when reporting on the root folders of the comparison.

2014-01-28  Philippe Troin  <phil+github-commits@fifi.org>

	* tdiff.c (compareXattrs): Compare Xattrs, reorg missing elements
	printing.
	ACLS support.

	* Makefile.am (AM_CFLAGS): Add -Wall.

	* tdiff.c (newStrList, pushStrList): Created and abstracted.
	(compareStrList): Created and abstracted string list comparison.

2014-01-27  Philippe Troin  <phil+github-commits@fifi.org>

	* Convert to automake.

	* tdiff.c (cmpFiles): Use madvise(MADV_WILLNEED)

2006-09-19  Philippe Troin  <phil+github-commits@fifi.org>

	* tdiff.c: Call getdents correctly on modern linux.  Use long long
	to print file sizes for LFS compatibility.

	* configure.in: Fix getdents detection on modern linux.  Upgrade
	to autoconf 2.59.  Use LFS.

	* inocache.c (ic_hash): Fix 64-bit hashing.
